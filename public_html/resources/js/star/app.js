Ext.define("STAR.Events",{extend:"Ext.util.Observable",singleton:!0,showInfoWindow:function(a){Ext.Msg.show({title:"Success!",msg:a,icon:Ext.Msg.INFO,buttons:Ext.Msg.OK})},showCautionWindow:function(a){Ext.Msg.show({title:"Caution!",msg:a,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}});Ext.ns("STAR","STAR.Controllers");STAR.Controllers="STAR.controller.list.Tree,STAR.controller.list.Form,STAR.controller.feed.Grid,STAR.controller.import.Form,STAR.controller.subscription.Form,STAR.controller.account.Form,STAR.controller.account.Window,STAR.controller.header.SettingButton,STAR.controller.container.LeftPanel".split(",");Ext.define("STAR.view.container.DescriptionPanel",{extend:"Ext.panel.Panel",alias:"widget.container-DescriptionPanel",style:"margin-bottom: 25px;",border:!1,initComponent:function(){this.head=void 0===this.head?"":'<h2 class="container-description-header">'+this.head+"</h2>";this.description=void 0===this.description?"":"<p>"+this.description+"</p>";Ext.apply(this,{html:this.head+this.description});this.callParent(arguments)}});Ext.define("STAR.controller.list.Form",{extend:"Ext.app.Controller",refs:[{ref:"form",selector:"list-Form"},{ref:"tree",selector:"list-Tree"}],init:function(){var a=this;a.control({"list-Form":{submit:a.submit},"list-CreateFolderWindow":{successsubmit:function(b){b.close();a.getTree().fireEvent("reloadandreselect")}},"list-RenameWindow":{successsubmit:function(b){b.close();a.getTree().fireEvent("reloadandreselect")}}})},submit:function(a){var b=this,c=b.getForm();a.disable();if(c.getForm().isValid()){var d=
new Ext.LoadMask(Ext.getBody(),{msg:STAR.locale.common.mask.wait});d.show();c.getForm().submit({success:function(){d.hide();var a=b.getForm().up("window");a&&a.fireEvent("successsubmit",a)},failure:function(b,c){d.hide();a.enable();STAR.Events.showCautionWindow(c.result.msg)}})}else a.enable()}});Ext.define("STAR.controller.list.Tree",{extend:"Ext.app.Controller",refs:[{ref:"tree",selector:"list-Tree"},{ref:"ImportWindow",selector:"import-Window"},{ref:"SubscriptionWindow",selector:"subscription-Window"}],init:function(){var a=this;a.control({"list-Tree":{load:function(){var b=a.getTree();if(null===b.getLastSelected()){var c=b.getRootNode().firstChild;b.getSelectionModel().select(c)}},beforeitemmove:function(a,c,d){if("0"!==d.raw.level&&"1"===a.raw.is_folder)return!1},itemmove:function(a,
c,d,e){ListData.move({list_id:a.raw.id,old_parent:c.raw.id,new_parent:d.raw.id,index:e},function(a){a.success||STAR.Events.showInfoWindow(a.msg)})},itemcontextmenu:function(b,c,d,e,f){if("0"==c.raw.level)return!1;b=a.getTree().buildContextMenu(c);f.stopEvent();b.showAt(f.getXY());a.getTree().getSelectionModel().select(c)},itemrename:a.itemRename,createfolder:a.createFolder,itemderegister:a.itemDeregister,reloadandreselect:a.reloadAndReselect},"import-Window":{successsubmit:function(){a.getImportWindow().close();
a.getTree().setLastSelected(null);a.getTree().fireEvent("reloadandreselect")}},"subscription-Window":{successsubmit:function(b){a.getSubscriptionWindow().close();a.getTree().setLastSelected(b);a.getTree().fireEvent("reloadandreselect")}}})},itemRename:function(a){Ext.create("STAR.view.list.RenameWindow",{node:a}).show()},createFolder:function(a){Ext.create("STAR.view.list.CreateFolderWindow",{node:a}).show()},itemDeregister:function(a){var b=this;Ext.Msg.confirm("Confirm",STAR.locale.list.msg.deregister,
function(c){if("yes"==c){var d=new Ext.LoadMask(Ext.getBody(),{msg:STAR.locale.common.mask.wait});d.show();ListData.Deregister({list_id:a.raw.id},function(a){d.hide();a.success?(b.getTree().setLastSelected(null),b.getTree().fireEvent("reloadandreselect")):STAR.Events.showCautionWindow(a.msg)})}})},reloadAndReselect:function(){var a=this.getTree(),b=a.getLastSelected();a.getStore().load({callback:function(){if(null!==b){var c=a.getStore().getNodeById(b.raw.id);c.isLeaf()&&c.parentNode.expand();a.getSelectionModel().select(c)}}})}});Ext.define("STAR.store.list.Tree",{extend:"Ext.data.TreeStore",constructor:function(){Ext.apply(this,{autoLoad:!0,proxy:{type:"direct",directFn:ListData.getList}});this.callParent(arguments)}});Ext.define("STAR.view.list.Form",{extend:"Ext.form.Panel",alias:"widget.list-Form",bodyStyle:"padding: 20px;",border:!1,initComponent:function(){this.items=[];this.buildNodeIdField();this.buildNameField();this.callParent(arguments)},buildNodeIdField:function(){this.items.push({xtype:"hiddenfield",name:"list_id",allowBlank:!1,value:this.node.raw.id})},buildNameField:function(){this.items.push({xtype:"textfield",name:"name",labelWidth:80,fieldLabel:STAR.locale.list.field.name,allowBlank:!1,width:400,
listeners:{render:function(a){a.focus(!0,400)}}})}});Ext.define("STAR.view.list.CreateFolderWindow",{extend:"Ext.window.Window",alias:"widget.list-CreateFolderWindow",requires:["STAR.view.list.Form"],title:STAR.locale.list.title.create_folder_window,iconCls:"list-create-folder-icon",modal:!0,closable:!1,layout:"fit",width:455,height:125,initComponent:function(){var a=this;Ext.apply(a,{items:[{xtype:"list-Form",node:a.node,api:{submit:ListData.createFolder}}],buttons:[{text:STAR.locale.common.button.cancel,handler:function(){a.close()}},{text:STAR.locale.common.button.submit,
handler:function(b){a.down("list-Form").fireEvent("submit",b)}}]});a.callParent(arguments)}});Ext.define("STAR.view.list.RenameWindow",{extend:"Ext.window.Window",alias:"widget.list-RenameWindow",requires:["STAR.view.list.Form"],modal:!0,closable:!1,layout:"fit",initComponent:function(){var a=this,b,c;"1"==a.node.raw.is_folder?(b=a.node.raw.text+": "+STAR.locale.list.title.folder_rename_window,c="list-folder-rename-icon"):(b=a.node.raw.text+": "+STAR.locale.list.title.item_rename_window,c="list-item-rename-icon");Ext.apply(a,{iconCls:c,title:b,items:[{xtype:"list-Form",node:a.node,api:{submit:ListData.rename}}],
buttons:[{text:STAR.locale.common.button.cancel,handler:function(){a.close()}},{text:STAR.locale.common.button.submit,handler:function(b){a.down("list-Form").fireEvent("submit",b)}}],width:455,height:125});a.callParent(arguments)}});Ext.define("STAR.view.list.Tree",{extend:"Ext.tree.Panel",alias:"widget.list-Tree",config:{LastSelected:null},layout:"fit",lines:!1,rootVisible:!1,useArrows:!0,autoScroll:!0,viewConfig:{loadMask:!0,plugins:{ptype:"treeviewdragdrop"}},initComponent:function(){this.buildStore();this.callParent(arguments)},buildStore:function(){this.store=Ext.create("STAR.store.list.Tree")},buildContextMenu:function(a){var b=this,c=[];"1"==a.raw.is_folder?c.push({text:STAR.locale.list.menu.folder_rename,handler:function(){b.fireEvent("itemrename",
a)}},{text:STAR.locale.list.menu.deregistration,handler:function(){b.fireEvent("itemderegister",a)}}):c.push({text:STAR.locale.list.menu.item_rename,handler:function(){b.fireEvent("itemrename",a)}},{text:STAR.locale.list.menu.create_folder,handler:function(){b.fireEvent("createfolder",a)}},{text:STAR.locale.list.menu.deregistration,handler:function(){b.fireEvent("itemderegister",a)}});return menu=Ext.create("Ext.menu.Menu",{bodyStyle:"padding: 5px;",items:c})}});Ext.define("STAR.controller.feed.Grid",{extend:"Ext.app.Controller",refs:[{ref:"Grid",selector:"feed-Grid"},{ref:"Tree",selector:"list-Tree"}],init:function(){var a=this;a.control({"feed-Grid":{select:function(a,c){"0"==c.raw.is_read&&Feed.readable({feed_id:c.raw.feed_id},function(a){a.success||STAR.Events.showCautionWindow(a.msg)});window.open(c.raw.feed_url,"_blank")},pocket:function(b){b=a.getGrid().getStore().getAt(b);console.log(b)},hatebu:function(b){b=a.getGrid().getStore().getAt(b);window.open("http://b.hatena.ne.jp/entry/"+
b.raw.feed_url)}},"list-Tree":{select:function(b,c){a.getTree().setLastSelected(c);a.getGrid().getStore().load({params:{list_id:c.raw.id}})}}})}});Ext.define("STAR.store.feed.Grid",{extend:"Ext.data.Store",autoLoad:!1,fields:[{name:"list_title"},{name:"feed_title"},{name:"date"}],proxy:{type:"direct",directFn:Feed.getList,reader:{root:"contents"}}});Ext.define("STAR.view.feed.Grid",{extend:"Ext.grid.Panel",alias:"widget.feed-Grid",id:"STAR-view-feed-Grid",layout:"fit",hideHeaders:!0,stripeRows:!0,loadMask:!0,initComponent:function(){this.buildStore();this.buildColumn();this.callParent(arguments)},buildStore:function(){this.store=Ext.create("STAR.store.feed.Grid")},buildColumn:function(){this.columns=[{xtype:"actioncolumn",width:25,items:[{getClass:this.getStarIconCls}]},{xtype:"actioncolumn",width:25,items:[{getClass:this.getPocketIconCls,handler:function(a,
b){this.fireEvent("pocket",b)},scope:this}]},{xtype:"actioncolumn",width:25,items:[{iconCls:"feed-item-hatebu-icon",handler:function(a,b){this.fireEvent("hatebu",b)},scope:this}]},{text:"list_title",dataIndex:"list_title",sortable:!1,menuDisabled:!0,flex:2},{text:"feed_title",dataIndex:"feed_title",renderer:this.renderTitle,sortable:!1,menuDisabled:!0,flex:7},{text:"date",dataIndex:"date",renderer:this.renderDate,sortable:!1,menuDisabled:!0,flex:0.6}]},getStarIconCls:function(){},getPocketIconCls:function(){return"feed-item-pocket-unset-icon"},
renderTitle:function(a,b,c){"1"==c.raw.is_read&&(a='<span class="feed-item-read">'+a+"</span>");return a},renderDate:function(a){var b=new Date,c=b.getYear(),d=b.getMonth()+1,b=b.getDate();2E3>c&&(c+=1900);10>d&&(d="0"+d);10>b&&(b="0"+b);return a.substr(0,10)==c+"-"+d+"-"+b?a.substr(11,5):d+"/"+b}});Ext.define("STAR.controller.subscription.Form",{extend:"Ext.app.Controller",refs:[{ref:"Form",selector:"subscription-Form"},{ref:"Window",selector:"subscription-Window"}],init:function(){var a=this;a.control({'subscription-Window button[action="subscription"]':{click:function(b){a.submit(b)}},'subscription-Form textfield[name="url"]':{render:function(a){a.focus(!1,400)}}})},submit:function(a){var b=this,c=b.getForm();if(c.getForm().isValid()){a.disable();var d=new Ext.LoadMask(Ext.getBody(),{msg:STAR.locale.common.mask.wait});
d.show();c.getForm().submit({success:function(a,c){d.hide();var g=b.getWindow();g&&g.fireEvent("successsubmit",c.node_id)},failure:function(b,c){a.enable();d.hide();STAR.Events.showCautionWindow(c.result.msg)}})}}});Ext.define("STAR.store.subscription.Directory",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"title"}],proxy:{type:"direct",directFn:ListData.fetchDirectories}});Ext.define("STAR.view.subscription.Form",{extend:"Ext.form.Panel",alias:"widget.subscription-Form",requires:["STAR.view.container.DescriptionPanel"],border:!1,bodyStyle:"padding: 20px;",defaults:{width:430,labelWidth:80},initComponent:function(){this.items=[];this.buildDescriptionPanel();this.buildURLField();this.buildDirectoryField();this.callParent(arguments)},buildDescriptionPanel:function(){this.items.push({xtype:"container-DescriptionPanel",head:STAR.locale.subscription.msg.head,description:STAR.locale.subscription.msg.description})},
buildURLField:function(){this.items.push({xtype:"textfield",fieldLabel:STAR.locale.subscription.field.url,name:"url",vtype:"url",allowBlank:!1})},buildDirectoryField:function(){this.items.push({xtype:"combobox",store:Ext.create("STAR.store.subscription.Directory"),name:"directory",fieldLabel:STAR.locale.subscription.field.directory,displayField:"title",valueField:"id",typeAhead:!0,forceSelection:!0,selectOnFocus:!0,queryMode:"remote",minChars:2})}});Ext.define("STAR.view.subscription.Window",{extend:"Ext.window.Window",alias:"widget.subscription-Window",requires:["STAR.view.subscription.Form"],iconCls:"subscription-window-icon",title:STAR.locale.subscription.title.window,layout:"fit",modal:!0,width:490,height:280,initComponent:function(){var a=this;Ext.apply(a,{items:[{xtype:"subscription-Form",api:{submit:ListData.subscription}}],buttons:[{text:STAR.locale.common.button.cancel,handler:function(){a.close()}},{text:STAR.locale.subscription.button.subscription,
action:"subscription"}]});a.callParent(arguments)}});Ext.define("STAR.controller.import.Form",{extend:"Ext.app.Controller",refs:[{ref:"form",selector:"import-Form"},{ref:"tree",selector:"list-Tree"}],init:function(){this.control({"import-Form":{submit:this.submit}})},submit:function(a){var b=this,c=b.getForm();if(c.getForm().isValid()){a.disable();var d=new Ext.LoadMask(Ext.getBody(),{msg:STAR.locale.g_import.mask.g_import});d.show();c.getForm().submit({success:function(){d.hide();STAR.Events.showInfoWindow(STAR.locale.g_import.msg.successimport);var a=
b.getForm().up("import-Window");a&&a.fireEvent("successsubmit")},failure:function(b,c){d.hide();a.enable();STAR.Events.showCautionWindow(c.result.msg)}})}}});Ext.define("STAR.view.import.Form",{extend:"Ext.form.Panel",alias:"widget.import-Form",requires:["STAR.view.container.DescriptionPanel"],border:!1,bodyStyle:"padding: 20px;",initComponent:function(){Ext.apply(this,{items:[{xtype:"container-DescriptionPanel",head:STAR.locale.g_import.msg.head,description:STAR.locale.g_import.msg.description},{xtype:"filefield",fieldLabel:STAR.locale.g_import.field.google,labelWidth:140,name:"file",allowBlank:!1,width:500}]});this.callParent(arguments)}});Ext.define("STAR.view.import.Window",{extend:"Ext.window.Window",alias:"widget.import-Window",requires:["STAR.view.import.Form"],title:STAR.locale.g_import.title.window,iconCls:"import-window-icon",layout:"fit",modal:!0,closable:!1,width:555,height:220,initComponent:function(){var a=this;Ext.apply(a,{items:[{xtype:"import-Form",api:{submit:ListData.dataImport},listeners:{windowClose:function(){a.close()}}}],buttons:[{text:STAR.locale.common.button.cancel,handler:function(){a.close()}},{text:STAR.locale.g_import.button.g_import,
handler:function(b){a.down("import-Form").fireEvent("submit",b)}}]});a.callParent(arguments)}});Ext.define("STAR.controller.account.Form",{extend:"Ext.app.Controller",refs:[{ref:"Form",selector:"account-Form"}],init:function(){var a=this;a.control({"account-Form":{afterrender:function(){a.getForm().getForm().load({success:function(b){a.getForm().down('textfield[name="username"]').setValue(b.name);a.getForm().down('hidden[name="id"]').setValue(b.id)}})}},'account-Form textfield[name="username"]':{afterrender:function(a){a.focus(!0,400)}}})}});Ext.define("STAR.controller.account.Window",{extend:"Ext.app.Controller",refs:[{ref:"Window",selector:"account-Window"},{ref:"Form",selector:"account-Form"}],init:function(){var a=this;a.control({'account-Window button[action="close"]':{click:function(){a.getWindow().close()}},'account-Window button[action="update"]':{click:a.submit}})},submit:function(a){var b=this,c=b.getForm();c.getForm().isValid()&&Ext.Msg.confirm("Confirm",STAR.locale.account.msg.confirm_update,function(d){if("yes"==d){a.disable();
var e=new Ext.LoadMask(Ext.getBody(),{msg:STAR.locale.common.mask.wait});e.show();c.getForm().submit({success:function(){e.hide();b.getWindow().close();STAR.Events.showInfoWindow(STAR.locale.account.msg.success_update)},failure:function(b,c){a.enable();e.hide();STAR.Events.showCautionWindow(c.result.msg)}})}})}});Ext.define("STAR.view.account.Form",{extend:"Ext.form.Panel",alias:"widget.account-Form",requires:["STAR.view.container.DescriptionPanel"],border:!1,bodyStyle:"padding: 20px;",initComponent:function(){this.buildVtype();this.items=[];this.buildDescription();this.buildUserId();this.buildUserName();this.buildPassword();this.buildConfirmPassword();this.callParent(arguments)},buildVtype:function(){var a=this;Ext.apply(Ext.form.field.VTypes,{username:function(a){return/^[!-\.:-@\[-`{-~a-zA-Z0-9]+$/.test(a)?
!0:!1},usernameText:STAR.locale.account.msg.invalid_username,retype:function(b){return a.down('textfield[name="password"]').getValue()===b?!0:!1},retypeText:STAR.locale.account.msg.invalid_password})},buildDescription:function(){this.items.push({xtype:"container-DescriptionPanel",head:STAR.locale.account.msg.head,description:STAR.locale.account.msg.description})},buildUserId:function(){this.items.push({xtype:"hidden",name:"id",allowBlank:!1})},buildUserName:function(){this.items.push({xtype:"textfield",
name:"username",fieldLabel:STAR.locale.account.field.username,allowBlank:!1,vtype:"username",width:350})},buildPassword:function(){this.items.push({xtype:"textfield",name:"password",inputType:"password",fieldLabel:STAR.locale.account.field.password,vtype:"username",width:350})},buildConfirmPassword:function(){this.items.push({xtype:"textfield",name:"confirm",inputType:"password",fieldLabel:STAR.locale.account.field.confirm_password,vtype:"retype",width:350})}});Ext.define("STAR.view.account.Window",{extend:"Ext.window.Window",alias:"widget.account-Window",requires:["STAR.view.account.Form"],title:STAR.locale.account.title.window,modal:!0,width:550,height:280,initComponent:function(){Ext.apply(this,{items:[{xtype:"account-Form",api:{load:User.getAccountData,submit:User.update}}],buttons:[{text:STAR.locale.common.button.cancel,action:"close"},{text:STAR.locale.common.button.update,action:"update"}]});this.callParent(arguments)}});Ext.define("STAR.controller.header.SettingButton",{extend:"Ext.app.Controller",init:function(){var a=this;a.control({'header-SettingButton menuitem[action="g_import"]':{click:function(){Ext.create("STAR.view.import.Window").show()}},'header-SettingButton menuitem[action="account"]':{click:function(){Ext.create("STAR.view.account.Window").show()}},'header-SettingButton menuitem[action="logout"]':{click:function(b){a.logout(b)}}})},logout:function(a){Ext.Msg.confirm("Confirm",STAR.locale.header.confirm.logout,
function(b){"yes"==b&&(a.disable(),(new Ext.LoadMask(Ext.getBody(),{msg:STAR.locale.common.mask.wait})).show(),User.logout(null,function(a){a.success&&Ext.getBody().fadeOut({callback:function(){window.location.reload()}})}))})}});Ext.define("STAR.view.header.TitlePanel",{extend:"Ext.container.Container",alias:"widget.header-TitlePanel",layout:"fit",border:!1,initComponent:function(){this.items=[];this.buildHTML();this.callParent(arguments)},buildHTML:function(){this.items.push({xtype:"container",border:!1,html:'<table class="header-title-container"><tbody><tr><td id="header-title-star-icon"><img src="/resources/image/star.png" /></td><td id="header-title-star-text"><h1 class="wire-one">STAR</h1></td></tr></tbody></table>'})}});Ext.define("STAR.view.header.SearchField",{extend:"Ext.container.Container",alias:"widget.header-SearchField",layout:"hbox",border:!1,margin:"5 0 0 0",initComponent:function(){this.items=[];this.buildSearchField();this.callParent(arguments)},buildSearchField:function(){this.items.push({xtype:"textfield",name:"query",width:420,height:30},{xtype:"button",text:"\u691c\u7d22",scale:"medium",margin:"0 0 0 20",height:30})}});Ext.define("STAR.view.header.SettingButton",{extend:"Ext.button.Button",alias:"widget.header-SettingButton",text:STAR.locale.header.button.setting,scale:"medium",menu:[{text:STAR.locale.header.menu.g_import,action:"g_import"},{text:STAR.locale.header.menu.account,action:"account"},{text:STAR.locale.header.menu.logout,action:"logout"}],margin:"5 25 0 0"});Ext.define("STAR.controller.container.LeftPanel",{extend:"Ext.app.Controller",refs:[{ref:"panel",selector:"container-LeftPanel"}],init:function(){this.control({"container-LeftPanel button[action=subscription]":{click:function(){Ext.create("STAR.view.subscription.Window").show()}}})}});Ext.define("STAR.view.container.LeftPanel",{extend:"Ext.container.Container",alias:"widget.container-LeftPanel",requires:["STAR.view.list.Tree"],layout:"border",initComponent:function(){Ext.apply(this,{items:[{region:"north",bodyStyle:"padding: 24px 33px;",layout:"fit",items:[{xtype:"button",action:"subscription",scale:"large",width:60,text:STAR.locale.container.button.entry}],height:80},{xtype:"list-Tree",region:"center"}]});this.callParent(arguments)}});Ext.define("STAR.view.container.RightPanel",{extend:"Ext.container.Container",alias:"widget.container-RightPanel",requires:["STAR.view.feed.Grid"],layout:"fit",initComponent:function(){Ext.apply(this,{items:[{xtype:"feed-Grid"}]});this.callParent(arguments)}});Ext.define("STAR.view.container.HeaderPanel",{extend:"Ext.container.Container",alias:"widget.container-HeaderPanel",requires:["STAR.view.header.TitlePanel","STAR.view.header.SearchField","STAR.view.header.SettingButton"],layout:"hbox",margin:"15 0 0 25",initComponent:function(){Ext.apply(this,{items:[{xtype:"header-TitlePanel",width:170},{xtype:"header-SearchField"},{xtype:"tbfill"},{xtype:"header-SettingButton"}]});this.callParent(arguments)}});Ext.define("STAR.view.container.MainPanel",{extend:"Ext.container.Container",alias:"widget.container-MainPanel",requires:["STAR.view.container.LeftPanel","STAR.view.container.RightPanel"],layout:"border",initComponent:function(){Ext.apply(this,{items:[{xtype:"container-LeftPanel",region:"west",split:!0,width:250},{xtype:"container-RightPanel",region:"center",split:!0}]});this.callParent(arguments)}});Ext.define("STAR.view.Viewport",{extend:"Ext.container.Viewport",alias:"widget.view-Viewport",requires:["STAR.view.container.HeaderPanel","STAR.view.container.MainPanel"],layout:"border",initComponent:function(){Ext.apply(this,{items:[{xtype:"container-HeaderPanel",region:"north"},{xtype:"container-MainPanel",region:"center"}]});this.callParent(arguments)}});Ext.application({controllers:STAR.Controllers,launch:function(){Ext.create("STAR.view.Viewport")}});
